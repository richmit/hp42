<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-05-28 Wed 15:41 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=1024, initial-scale=1" />
<title>free42 Programming Tools</title>
<meta name="author" content="Mitch Richling" />
<meta name="description" content="Random stuff to assist with free42/hp-42s/DM42 programing" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<style>body { width: 95%; margin: 2% auto; font-size: 18px; line-height: 1.4em; font-family: Georgia, serif; color: black; background-color: white; }</style>
<style>body { min-width: 500px; max-width: 1024px; }</style>
<style>h1,h2,h3,h4,h5,h6 { color: #A5573E; line-height: 1em; font-family: Helvetica, sans-serif; }</style>
<style>h1,h2,h3 { line-height: 1.4em; }</style>
<style>h1.title { font-size: 3em; }</style>
<style>h4,h5,h6 { font-size: 1em; }</style>
<style>.org-src-container { border: 1px solid #ccc; box-shadow: 3px 3px 3px #eee; font-family: Lucida Console, monospace; font-size: 80%; margin: 0px; padding: 0px 0px; position: relative; }</style>
<style>.org-src-container>pre { line-height: 1.2em; padding-top: 1.5em; margin: 0.5em; background-color: #404040; color: white; overflow: auto; }</style>
<style>.org-src-container>pre:before { display: block; position: absolute; background-color: #b3b3b3; top: 0; right: 0; padding: 0 0.2em 0 0.4em; border-bottom-left-radius: 8px; border: 0; color: white; font-size: 100%; font-family: Helvetica, sans-serif;}</style>
<style>pre.example { white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -o-pre-wrap; font-family: Lucida Console, monospace; font-size: 80%; background: #404040; color: white; display: block; padding: 0em; border: 2px solid black; }</style>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="https://richmit.github.io/hp42/"> UP </a>
 |
 <a accesskey="H" href="https://www.mitchr.me/"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">free42 Programming Tools</h1>
<table border="2 solid #ccc" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" align="center">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-right"><b>Author:</b></td>
<td class="org-left"><i>Mitch Richling</i></td>
</tr>

<tr>
<td class="org-right"><b>Updated:</b></td>
<td class="org-left"><i>2025-05-28 15:19:55</i></td>
</tr>
</tbody>
</table>
<p align="center">
Copyright 2025 Mitch Richling. All rights reserved.
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org73fd436">1. Metadata</a></li>
<li><a href="#introduction">2. Introduction</a></li>
<li><a href="#menu-gen">3. Generating 42s menu code</a>
<ul>
<li><a href="#orga434c6a">3.1. Generic menu generator</a></li>
<li><a href="#org2d80755">3.2. For CUSTOM-type Menus</a></li>
<li><a href="#org2af792b">3.3. Always generate local lables</a></li>
</ul>
</li>
<li><a href="#org0c0a0c5">4. Emacs Helper Stuff</a>
<ul>
<li><a href="#org3f03cbf">4.1. Prepare Code For Conversion</a></li>
<li><a href="#org3f5b256">4.2. Automatically processing tangled code</a></li>
<li><a href="#org4da2549">4.3. Tangle &amp; Load Tangled File</a></li>
<li><a href="#org3560c28">4.4. yas templates</a></li>
</ul>
</li>
<li><a href="#org8a849db">5. free42 Notes</a>
<ul>
<li><a href="#org3fd4803">5.1. Character Set</a></li>
<li><a href="#org0d03ec2">5.2. Date format</a></li>
<li><a href="#orga1e82c8">5.3. Stats registers</a></li>
</ul>
</li>
<li><a href="#orgaa68a31">6. DM 42 Notes</a>
<ul>
<li><a href="#org1f86d10">6.1. Display</a></li>
</ul>
</li>
<li><a href="#org638f4c6">7. EOF</a></li>
</ul>
</div>
</div>
<div id="outline-container-org73fd436" class="outline-2">
<h2 id="org73fd436"><span class="section-number-2">1.</span> Metadata</h2>
<div class="outline-text-2" id="text-1">
<p>
The home for this HTML file is: <a href="https://richmit.github.io/hp42/hp42s-meta.html">https://richmit.github.io/hp42/hp42s-meta.html</a>
</p>

<p>
Files related to this document may be found on github: <a href="https://github.com/richmit/hp42">https://github.com/richmit/hp42</a>
</p>

<p>
Directory contents:
</p>
<table border="0" cellspacing="0" cellpadding="6" rules="none" frame="none" align="center">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><code>src</code></td>
<td class="org-left">-</td>
<td class="org-left">The org-mode file that generated this HTML document</td>
</tr>

<tr>
<td class="org-left"><code>src_42s</code></td>
<td class="org-left">-</td>
<td class="org-left">Ready to convert source listings for 42s code in this document</td>
</tr>

<tr>
<td class="org-left"><code>docs</code></td>
<td class="org-left">-</td>
<td class="org-left">This html document and associated PDF</td>
</tr>

<tr>
<td class="org-left"><code>bin</code></td>
<td class="org-left">-</td>
<td class="org-left">Importable RAW program files</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-introduction" class="outline-2">
<h2 id="introduction"><span class="section-number-2">2.</span> Introduction</h2>
<div class="outline-text-2" id="text-introduction">
<p>
This org-mode document contains various tools (mostly for Emacs) that help me write programs for the 42s:
</p>

<ul class="org-ul">
<li>Elisp function to generate 42s menu programs</li>
<li>A tool to insert free42 utf-8 characters given a list of character numbers</li>
<li>Elisp function to generate custom menus (menus of built-in functions and global labels)</li>
<li>yasnippet templates to help type code</li>
<li>ElISP Code to translate my code listings into code for free42 &amp; MD42</li>
<li>42s notes
<ul class="org-ul">
<li>free42 utf-8 characters with character numbers</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-menu-gen" class="outline-2">
<h2 id="menu-gen"><span class="section-number-2">3.</span> Generating 42s menu code</h2>
<div class="outline-text-2" id="text-menu-gen">
</div>
<div id="outline-container-orga434c6a" class="outline-3">
<h3 id="orga434c6a"><span class="section-number-3">3.1.</span> Generic menu generator</h3>
<div class="outline-text-3" id="text-3-1">
<p>
This code will read an org-mode table describing a menu, and generate 42s code to implement the menu.  The only limitation on menu depth and size are the
number of available two digit labels.  
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" align="center">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Line</th>
<th scope="col" class="org-left">Menu alpha strings</th>
<th scope="col" class="org-left">Menu targets</th>
<th scope="col" class="org-left">Some Data</th>
<th scope="col" class="org-left">Some More Data</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">foo:bar:foobar</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">marry</td>
<td class="org-left">red</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">foo:bar:LBL 77</td>
<td class="org-left">LBL 87</td>
<td class="org-left">had a</td>
<td class="org-left">blue</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">foo:bar:LBL 78</td>
<td class="org-left">fooboo</td>
<td class="org-left">little</td>
<td class="org-left">yellow</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">foo:bar:LBL 78</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">lamb</td>
<td class="org-left">green</td>
</tr>
</tbody>
</table>


<p>
One column of the table is used to define the <i>menu alpha strings</i>. The table above provides an example.  The string <code>foo:bar:foobar</code> (table line 1)
defines a top level button named <code>foo</code> that leads to a menu containing another menu named <code>bar</code> which contains an <i>action</i> key named <code>foobar</code>.  The final
component, <code>foobar</code> in this example, is used for the alpha string for the menu key.  It is used as-is with one exception.  That exception occurs when the
final component looks like "<code>LBL NN</code>" where <code>NN</code> is a two digit number (table line 2).  In this case the local label will be <code>XEQ</code>'ed just before the call to
<code>KEY</code>.  This allows the key's alpha string to be dynamically generated by a subroutine at run time.  If this subroutine returns <code>RETNO</code> then the menu key's
<code>KEY</code> command will be skipped.  In this way one can dynamically decide if a menu key should be active or not.  If the key string is "" (empty) or "▒▒▒▒", then
a blank key will be placed in the menu.
</p>

<p>
Now that we know how the menu key strings are constructed, what about the <code>GTO/XEQ</code> target for the generated <code>KEY</code> commands?  The following
rules are applied with the first one matching being used:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" align="center">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><code>gen-target-label</code></th>
<th scope="col" class="org-left"><code>target-column</code></th>
<th scope="col" class="org-left"><i>Menu Key</i></th>
<th scope="col" class="org-left"><i>Menu Target</i></th>
<th scope="col" class="org-left">The <code>XEQ/GTO</code> Target</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>nil</code></td>
<td class="org-left"><code>nil</code></td>
<td class="org-left">"<code>LBL NN</code>"</td>
<td class="org-left">N/A</td>
<td class="org-left">Auto-generated</td>
</tr>

<tr>
<td class="org-left"><code>nil</code></td>
<td class="org-left"><code>nil</code></td>
<td class="org-left">N/A</td>
<td class="org-left">N/A</td>
<td class="org-left">Menu key string</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><code>nil</code></td>
<td class="org-left">non-<code>nil</code></td>
<td class="org-left">"<code>LBL NN</code>"</td>
<td class="org-left">"" (empty)</td>
<td class="org-left">Auto-generated</td>
</tr>

<tr>
<td class="org-left"><code>nil</code></td>
<td class="org-left">non-<code>nil</code></td>
<td class="org-left">N/A</td>
<td class="org-left">"" (empty)</td>
<td class="org-left">Menu key string</td>
</tr>

<tr>
<td class="org-left"><code>nil</code></td>
<td class="org-left">non-<code>nil</code></td>
<td class="org-left">N/A</td>
<td class="org-left">"<code>LBL NN</code>"</td>
<td class="org-left"><code>NN</code></td>
</tr>

<tr>
<td class="org-left"><code>nil</code></td>
<td class="org-left">non-<code>nil</code></td>
<td class="org-left">N/A</td>
<td class="org-left">N/A</td>
<td class="org-left">Menu target</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">non-<code>nil</code></td>
<td class="org-left">N/A</td>
<td class="org-left">N/A</td>
<td class="org-left">N/A</td>
<td class="org-left">See next table</td>
</tr>
</tbody>
</table>

<p>
When <code>gen-target-label</code> is non-<code>nil</code>, the return value of the function determines the target.  If the return is <code>nil</code>, then the label is auto-generated.
Otherwise the returned string is used.  Note the returned string must contain embedded quotes if it is a global label target.
</p>

<p>
In general this might be summarized as follows: When <code>gen-target-label</code> is non-<code>nil</code>, the target is determined by the <code>gen-target-label</code> function.  When
<code>gen-target-label</code> is <code>nil</code>, then the menu target column is used unless it is empty, and then the menu key is used.
</p>

<p>
When a local label is generated, the subroutine for that label will also be generated.  The content of that subroutine can be provided by calling the a user
provided function via the <code>gen-target-code</code> argument.  This allows the <b>entire</b> program to be generated from the contents of the table my <a href="https://richmit.github.io/hp42/cons.html">constants</a> &amp; <a href="https://richmit.github.io/hp42/unit.html">units</a>
programs are good examples.  Note that if all the lables are generated, then the resulting program is ended with an <code>END</code> instruction.  
</p>

<p>
Note the Unicode point 166 (the "¦" character) is automatically converted to the pipe character ("|").  This lets you include the 42s pipe symbol in org-mode
tables.
</p>

<p>
<code>MJR-generate-42-menu-code</code> arguments:
</p>
<dl class="org-dl">
<dt><code>top-lab</code>                </dt><dd>The global label to use for the generated program</dd>
<dt><code>numeric-lbl-start</code>      </dt><dd>Beginning for a range of local numeric labels that will be used for the program</dd>
<dt><code>tbl</code>                    </dt><dd>The org-mode table with the menu description</dd>
<dt><code>menu-alpha-column</code>      </dt><dd>The column with the menu alpha strings</dd>
<dt><code>menu-exit-behavior</code>     </dt><dd>What to do when <code>[EXIT]</code> is pressed.
<ul class="org-ul">
<li><code>'exit</code>: Exit the application</li>
<li><code>'up</code>: Return to parent menu or exit if no parent</li>
</ul></dd>
<dt><code>after-leaf-action</code>      </dt><dd>What do do when a <i>action</i> menu is used (a leaf node in the menu)
<ul class="org-ul">
<li><code>'stay</code>: Keep the menu active</li>
<li><code>'exit</code>: Exit the menu</li>
</ul></dd>
<dt><code>include-end</code>            </dt><dd>Include final <code>END</code> statement
<ul class="org-ul">
<li><code>'yes</code>: Create final <code>END</code> statement</li>
<li><code>'exit</code>: Do not create final <code>END</code> statement</li>
<li><code>'auto</code>: Create final <code>END</code> statement if all menu target labels were generated</li>
</ul></dd>
<dt><code>target-column</code>          </dt><dd>nil means no target column.</dd>
<dt><code>gen-target-label</code>       </dt><dd>A function that generates the label for the <code>KEY</code> commands <code>GTO=/=XEQ</code>.  Return <code>nil</code> for autogen.
<ul class="org-ul">
<li>Arguments: autoish-target, list of row data</li>
<li>autoish-target is essentially the target that would have been used if <code>gen-target-label</code> were <code>nil</code>.  Local labels look like "<code>LBL NN</code>" and global ones look like "<code>FOO</code>".</li>
</ul></dd>
<dt><code>gen-target-code</code>        </dt><dd>A function that generates the code for the <i>action</i>.  It gets a list that contains the table row for the menu item.
<ul class="org-ul">
<li>Arguments: autoish-target, menu target label, list of row data</li>
</ul></dd>
</dl>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #00ffff;">defun</span> <span style="color: #00fa9a; font-weight: bold;">MJR-generate-42-menu-code</span> (top-lab 
                                  numeric-lbl-start
                                  tbl
                                  menu-alpha-column
                                  target-column
                                  after-leaf-action
                                  menu-exit-behavior
                                  include-end
                                  gen-target-label
                                  gen-target-code)
  (<span style="color: #00ffff;">let*</span> ((no-local 't)
         (min-free-lab (+ numeric-lbl-start 2))
         (m-code <span style="color: #fa8072;">""</span>)
         (x-code <span style="color: #fa8072;">""</span>))
    (<span style="color: #00ffff;">cl-labels</span> ((add-m-code (a) (<span style="color: #00ffff;">setq</span> m-code (concat m-code a <span style="color: #fa8072;">"\n"</span>)))
                (add-x-code (a) (<span style="color: #00ffff;">setq</span> x-code (concat x-code a <span style="color: #fa8072;">"\n"</span>)))
                (prc-mnu (menu)
                         (<span style="color: #00ffff;">if</span> (<span style="color: #00ffff;">or</span> (not (listp menu))
                                 (null (cdr menu)))
                             menu
                             (mapcar #'prc-mnu
                                     (append (list (car menu))
                                             (reverse
                                              (cl-reduce
                                               (<span style="color: #00ffff;">lambda</span> (result cur-elt)
                                                 (<span style="color: #00ffff;">let</span> ((last-elt (cl-first result)))
                                                   (<span style="color: #00ffff;">if</span> (<span style="color: #00ffff;">and</span> (listp last-elt)
                                                            (cdr last-elt)
                                                            (cdr cur-elt)
                                                            (string-equal (cl-first last-elt) (cl-first cur-elt)))
                                                       (<span style="color: #00ffff;">progn</span> (nconc (cl-first result) (list (cdr cur-elt)))
                                                              result)
                                                       (<span style="color: #00ffff;">if</span> (cdr cur-elt)
                                                           (append (list (list (cl-first cur-elt) (cdr cur-elt)))
                                                                   result)
                                                           (append (list (cl-first cur-elt))  result)))))
                                               (cdr menu)
                                               <span style="color: #b0c4de;">:initial-value</span> ()))))))
                (gen-mnu (parent-lbl lbl menu)
                         (<span style="color: #00ffff;">let*</span> ((num-menu-keys (1- (length menu)))
                                (num-menu-page (ceiling (/ num-menu-keys 6.0)))
                                (page-labs     (<span style="color: #00ffff;">cl-loop</span> repeat num-menu-page
                                                        for i = lbl then min-free-lab
                                                        collect i
                                                        when (not (= i lbl))
                                                        do (<span style="color: #00ffff;">cl-incf</span> min-free-lab)))
                                (rec-key-labs     nil)
                                (rec-pag-labs     nil))
                           (<span style="color: #00ffff;">if</span> (= parent-lbl numeric-lbl-start)
                               (add-m-code (format <span style="color: #fa8072;">"LBL \"%s\""</span> (cl-first menu))))
                           (<span style="color: #00ffff;">cl-loop</span> for mkey-elt in (cdr menu)
                                    for mkey-num from 0
                                    for page-num = (truncate (/ mkey-num 6))
                                    for page-key = (mod mkey-num 6)
                                    for mkey-str = (<span style="color: #00ffff;">if</span> (vectorp mkey-elt) (aref mkey-elt 0) (cl-first mkey-elt))
                                    for is-leaf  = (vectorp mkey-elt)
                                    for auto-trg = (<span style="color: #00ffff;">and</span> is-leaf 
                                                        (<span style="color: #00ffff;">or</span> (<span style="color: #00ffff;">if</span> target-column 
                                                                (<span style="color: #00ffff;">let</span> ((tmp (nth target-column (aref mkey-elt 1))))
                                                                  (<span style="color: #00ffff;">if</span> (not (string-empty-p tmp))
                                                                      tmp)))
                                                            (<span style="color: #00ffff;">if</span> (not (string-match-p <span style="color: #fa8072;">"^LBL [0-9][0-9]$"</span> mkey-str))
                                                                mkey-str)
                                                            <span style="color: #fa8072;">""</span>))
                                    for mkey-trg = (<span style="color: #00ffff;">and</span> is-leaf
                                                        (<span style="color: #00ffff;">if</span> gen-target-label
                                                            (funcall gen-target-label auto-trg (aref mkey-elt 1))
                                                            (<span style="color: #00ffff;">and</span> (not (string-empty-p auto-trg))
                                                                 (<span style="color: #00ffff;">if</span> (string-match-p <span style="color: #fa8072;">"^LBL [0-9][0-9]$"</span> auto-trg)
                                                                     (substring auto-trg 4)
                                                                     (format <span style="color: #fa8072;">"\"%s\""</span> auto-trg)))))
                                    <span style="color: #ffa500;">;;</span><span style="color: #ff7f24;">do (print (format "mkey-str: %s    auto-trg: %s    mkey-trg: %s" mkey-str auto-trg mkey-trg))</span>
                                    when (= page-key 0)
                                    do (<span style="color: #00ffff;">progn</span> (add-m-code (format <span style="color: #fa8072;">"LBL %02d            @@@@ Page %d of menu %s"</span>
                                                                   (nth page-num page-labs)
                                                                   (1+ page-num)
                                                                   (cl-first menu)))
                                              (add-m-code <span style="color: #fa8072;">"CLMENU"</span>))
                                    when (not (<span style="color: #00ffff;">or</span> (string-empty-p mkey-str) (string-equal mkey-str <span style="color: #fa8072;">"&#9618;&#9618;&#9618;&#9618;"</span>)))
                                    do (<span style="color: #00ffff;">progn</span> (<span style="color: #00ffff;">if</span> (string-match-p <span style="color: #fa8072;">"^LBL [0-9][0-9]$"</span> mkey-str)
                                                  (<span style="color: #00ffff;">progn</span> (add-m-code (format <span style="color: #fa8072;">"XEQ %s"</span> (substring mkey-str 4)))
                                                         (<span style="color: #00ffff;">setq</span> no-local nil))
                                                  (add-m-code (format <span style="color: #fa8072;">"\"%s\""</span> mkey-str)))
                                              (<span style="color: #00ffff;">if</span> (<span style="color: #00ffff;">or</span> (not is-leaf) (not mkey-trg))
                                                  (add-m-code (format <span style="color: #fa8072;">"KEY %d %s %02d"</span> 
                                                                       (1+ page-key) 
                                                                       (<span style="color: #00ffff;">if</span> is-leaf <span style="color: #fa8072;">"XEQ"</span> <span style="color: #fa8072;">"GTO"</span>) 
                                                                       min-free-lab))
                                                  (<span style="color: #00ffff;">progn</span> 
                                                    (add-m-code (format <span style="color: #fa8072;">"KEY %d XEQ %s"</span> (1+ page-key) mkey-trg))
                                                    (<span style="color: #00ffff;">setq</span> no-local nil)))
                                              (<span style="color: #00ffff;">if</span> (<span style="color: #00ffff;">and</span> (not mkey-trg) is-leaf)
                                                  (<span style="color: #00ffff;">progn</span> (add-x-code (format 
                                                                      <span style="color: #fa8072;">"LBL %02d    @@@@ Action for menu key %s"</span> 
                                                                      min-free-lab
                                                                      mkey-str))
                                                         (<span style="color: #00ffff;">if</span> gen-target-code 
                                                             (add-x-code (funcall gen-target-code
                                                                                  auto-trg 
                                                                                  mkey-trg
                                                                                  (aref mkey-elt 1)))
                                                             (add-x-code (format <span style="color: #fa8072;">"@@@@ TODO: Code for %s!"</span> 
                                                                                  mkey-str)))
                                                         (add-x-code <span style="color: #fa8072;">"RTN"</span>)))
                                              (<span style="color: #00ffff;">push</span> min-free-lab rec-key-labs)
                                              (<span style="color: #00ffff;">if</span> (not mkey-trg)
                                                  (<span style="color: #00ffff;">cl-incf</span> min-free-lab))
                                              (<span style="color: #00ffff;">push</span> (nth page-num page-labs) rec-pag-labs))
                                    when (<span style="color: #00ffff;">or</span> (= page-key 5) (= mkey-num (1- num-menu-keys)))
                                    do (<span style="color: #00ffff;">progn</span> (<span style="color: #00ffff;">if</span> (&lt; 1 num-menu-page)
                                                  (<span style="color: #00ffff;">progn</span> (add-m-code (format <span style="color: #fa8072;">"KEY 7 GTO %02d"</span> 
                                                                              (nth (mod (1- page-num) 
                                                                                        num-menu-page) 
                                                                                   page-labs)))
                                                         (add-m-code (format <span style="color: #fa8072;">"KEY 8 GTO %02d"</span>
                                                                              (nth (mod (1+ page-num) 
                                                                                        num-menu-page) 
                                                                                   page-labs)))))
                                              (<span style="color: #00ffff;">if</span> (string-equal menu-exit-behavior <span style="color: #fa8072;">"up"</span>)
                                                  (add-m-code (format <span style="color: #fa8072;">"KEY 9 GTO %02d"</span> parent-lbl))
                                                  (add-m-code (format <span style="color: #fa8072;">"KEY 9 GTO %02d"</span> 0)))
                                              (add-m-code <span style="color: #fa8072;">"MENU"</span>)
                                              (add-m-code <span style="color: #fa8072;">"STOP"</span>)
                                              (<span style="color: #00ffff;">if</span> (string-equal after-leaf-action <span style="color: #fa8072;">"stay"</span>)
                                                  (add-m-code (format <span style="color: #fa8072;">"GTO %02d"</span> (nth page-num page-labs)))
                                                  (add-m-code (format <span style="color: #fa8072;">"GTO %02d"</span> 0)))))
                           (<span style="color: #00ffff;">cl-loop</span> for mkey-elt in (cdr menu)
                                    for m-lab in (reverse rec-key-labs)
                                    for p-lab in (reverse rec-pag-labs)
                                    when (listp mkey-elt)
                                    do (gen-mnu p-lab m-lab mkey-elt)))))
      (gen-mnu numeric-lbl-start 
               (1+ numeric-lbl-start)
               (prc-mnu (append (list top-lab) (<span style="color: #00ffff;">cl-loop</span> for row in tbl
                                                        for row-strs = (mapcar (<span style="color: #00ffff;">lambda</span> (x) (replace-regexp-in-string <span style="color: #fa8072;">"&#166;"</span> <span style="color: #fa8072;">"|"</span> (format <span style="color: #fa8072;">"%s"</span> x)  't 't)) 
                                                                               row)
                                                        for n from 0
                                                        for menu-parts = (split-string 
                                                                          (nth menu-alpha-column row-strs) 
                                                                          <span style="color: #fa8072;">":"</span>)
                                                        do (<span style="color: #00ffff;">setf</span> (car (last menu-parts))
                                                                 (vector (car (last menu-parts)) row-strs))
                                                        collect menu-parts))))
      (add-m-code (format <span style="color: #fa8072;">"LBL %02d @@@@ Application Exit"</span> numeric-lbl-start))
      (add-m-code <span style="color: #fa8072;">"EXITALL"</span>)
      (add-m-code <span style="color: #fa8072;">"RTN"</span>) 
      (<span style="color: #00ffff;">if</span> (&lt; 100 min-free-lab)
          (<span style="color: #ffc0cb; font-weight: bold;">error</span> <span style="color: #fa8072;">"ERROR: Too many local labels: %d"</span> min-free-lab)))
    (princ (format <span style="color: #fa8072;">"%s (ref:%s)\n"</span> (make-string 80 ?@)  top-lab))
    (princ (format <span style="color: #fa8072;">"@@@@ DSC: Auto-generated menu program\n"</span>))
    (princ m-code)
    (princ x-code)
    (princ (format <span style="color: #fa8072;">"@@@@ Free labels start at: %d\n"</span> min-free-lab))
    (<span style="color: #00ffff;">if</span> (<span style="color: #00ffff;">or</span> (string-equal include-end <span style="color: #fa8072;">"yes"</span>) (<span style="color: #00ffff;">and</span> (string-equal include-end <span style="color: #fa8072;">"auto"</span>) no-local))
        (princ <span style="color: #fa8072;">"END"</span>))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org2d80755" class="outline-3">
<h3 id="org2d80755"><span class="section-number-3">3.2.</span> For CUSTOM-type Menus</h3>
<div class="outline-text-3" id="text-3-2">
<p>
These functions are useful for CUSTOM-type menus &#x2013; that is menus that call other programs or built in functions.  I use this as a way to add hierarchy to the
built in CUSTOM menu.  Example:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" align="center">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Menu</th>
<th scope="col" class="org-left">Prog</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">LN</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">log</td>
<td class="org-left">LOG</td>
</tr>

<tr>
<td class="org-left">MYPROG</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
In the first line "<code>LN</code>" is the menu name and function called.  In the second line "<code>log</code>" is the menu name, and "<code>LOG</code>" is the function called.  In the third
line "<code>MYPROG</code>" is the name of a program &#x2013; the code below figures out if a thing is a built in function or a program and uses <code>XEQ</code> for programs.  Note that
I may have missed a built in function, so you may have to add one to the list. ;)
</p>

<p>
If the menu is of the for "LBL NN", then it will be <code>XEQ</code>'ed to get the menu label.  If the prog is of the form "LBL NN", then it will be <code>XEQ</code>'ed directly.
If any menu or prog is a label, then an <code>END</code> will not be generated at the end of the listing &#x2013; this allows one to put the local subroutines later in
the org-mode file and the whole thing will then be tangled together into one program.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #00ffff;">defun</span> <span style="color: #00fa9a; font-weight: bold;">MJR-is-42-builtin</span> (astring) (cl-position astring 
                                                '(<span style="color: #fa8072;">"%"</span> <span style="color: #fa8072;">"%CH"</span> <span style="color: #fa8072;">"+"</span> <span style="color: #fa8072;">"+/-"</span> <span style="color: #fa8072;">"-"</span> <span style="color: #fa8072;">"1/X"</span> <span style="color: #fa8072;">"10&#8593;X"</span> <span style="color: #fa8072;">"ABS"</span> <span style="color: #fa8072;">"ACOS"</span> <span style="color: #fa8072;">"ACOSH"</span> <span style="color: #fa8072;">"ADV"</span> <span style="color: #fa8072;">"AGRAPH"</span> <span style="color: #fa8072;">"AIP"</span> <span style="color: #fa8072;">"ALENG"</span> <span style="color: #fa8072;">"ALL"</span> <span style="color: #fa8072;">"ALL&#931;"</span> <span style="color: #fa8072;">"AND"</span> <span style="color: #fa8072;">"AOFF"</span> <span style="color: #fa8072;">"AON"</span>
                                                  <span style="color: #fa8072;">"ARCL"</span> <span style="color: #fa8072;">"AROT"</span> <span style="color: #fa8072;">"ASHF"</span> <span style="color: #fa8072;">"ASIN"</span> <span style="color: #fa8072;">"ASINH"</span> <span style="color: #fa8072;">"ASSIGN"</span> <span style="color: #fa8072;">"ASTO"</span> <span style="color: #fa8072;">"ATAN"</span> <span style="color: #fa8072;">"ATANH"</span> <span style="color: #fa8072;">"ATOX"</span> <span style="color: #fa8072;">"AVIEW"</span> <span style="color: #fa8072;">"BASE+"</span> <span style="color: #fa8072;">"BASE+/-"</span> <span style="color: #fa8072;">"BASE-"</span> <span style="color: #fa8072;">"BASE&#215;"</span>
                                                  <span style="color: #fa8072;">"BASE&#247;"</span> <span style="color: #fa8072;">"BEEP"</span> <span style="color: #fa8072;">"BEST"</span> <span style="color: #fa8072;">"BINM"</span> <span style="color: #fa8072;">"BIT?"</span>  <span style="color: #fa8072;">"BIT?"</span>  <span style="color: #fa8072;">"CF"</span> <span style="color: #fa8072;">"CLA"</span> <span style="color: #fa8072;">"CLD"</span> <span style="color: #fa8072;">"CLKEYS"</span> <span style="color: #fa8072;">"CLLCD"</span> <span style="color: #fa8072;">"CLMENU"</span> <span style="color: #fa8072;">"CLP"</span> <span style="color: #fa8072;">"CLRG"</span> <span style="color: #fa8072;">"CLST"</span> <span style="color: #fa8072;">"CLV"</span>
                                                  <span style="color: #fa8072;">"CLX"</span> <span style="color: #fa8072;">"CL&#931;"</span> <span style="color: #fa8072;">"COMB"</span> <span style="color: #fa8072;">"COMPLEX"</span> <span style="color: #fa8072;">"CORR"</span> <span style="color: #fa8072;">"COS"</span> <span style="color: #fa8072;">"COSH"</span> <span style="color: #fa8072;">"CPX?"</span>  <span style="color: #fa8072;">"CPXRES"</span> <span style="color: #fa8072;">"CROSS"</span> <span style="color: #fa8072;">"CUSTOM"</span> <span style="color: #fa8072;">"DECM"</span> <span style="color: #fa8072;">"DEG"</span> <span style="color: #fa8072;">"DELAY"</span> <span style="color: #fa8072;">"DELR"</span>
                                                  <span style="color: #fa8072;">"DET"</span> <span style="color: #fa8072;">"DIM"</span> <span style="color: #fa8072;">"DIM?"</span>  <span style="color: #fa8072;">"DOT"</span> <span style="color: #fa8072;">"DSE"</span> <span style="color: #fa8072;">"EDIT"</span> <span style="color: #fa8072;">"EDITN"</span> <span style="color: #fa8072;">"END"</span> <span style="color: #fa8072;">"ENG"</span> <span style="color: #fa8072;">"ENTER"</span> <span style="color: #fa8072;">"EXITALL"</span> <span style="color: #fa8072;">"EXPF"</span> <span style="color: #fa8072;">"E&#8593;X"</span> <span style="color: #fa8072;">"E&#8593;X-1"</span> <span style="color: #fa8072;">"FC?"</span>  <span style="color: #fa8072;">"FC?C"</span>
                                                  <span style="color: #fa8072;">"FCSTX"</span> <span style="color: #fa8072;">"FCSTY"</span> <span style="color: #fa8072;">"FIX"</span> <span style="color: #fa8072;">"FNRM"</span> <span style="color: #fa8072;">"FP"</span> <span style="color: #fa8072;">"FS?"</span>  <span style="color: #fa8072;">"FS?C"</span> <span style="color: #fa8072;">"FUNC"</span> <span style="color: #fa8072;">"GAMMA"</span> <span style="color: #fa8072;">"GETKEY"</span> <span style="color: #fa8072;">"GETM"</span> <span style="color: #fa8072;">"GRAD"</span> <span style="color: #fa8072;">"GROW"</span> <span style="color: #fa8072;">"GTO"</span> <span style="color: #fa8072;">"HEXM"</span> <span style="color: #fa8072;">"HMS+"</span>
                                                  <span style="color: #fa8072;">"HMS-"</span> <span style="color: #fa8072;">"I+"</span> <span style="color: #fa8072;">"I-"</span> <span style="color: #fa8072;">"INDEX"</span> <span style="color: #fa8072;">"INPUT"</span> <span style="color: #fa8072;">"INSR"</span> <span style="color: #fa8072;">"INTEG"</span> <span style="color: #fa8072;">"INVRT"</span> <span style="color: #fa8072;">"IP"</span> <span style="color: #fa8072;">"ISG"</span> <span style="color: #fa8072;">"J+"</span> <span style="color: #fa8072;">"J-"</span> <span style="color: #fa8072;">"KEY"</span> <span style="color: #fa8072;">"KEYASN"</span> <span style="color: #fa8072;">"L4STK"</span> <span style="color: #fa8072;">"LASTX"</span> <span style="color: #fa8072;">"LBL"</span>
                                                  <span style="color: #fa8072;">"LCLBL"</span> <span style="color: #fa8072;">"LINF"</span> <span style="color: #fa8072;">"LIN&#931;"</span> <span style="color: #fa8072;">"LN"</span> <span style="color: #fa8072;">"LN1+X"</span> <span style="color: #fa8072;">"LOG"</span> <span style="color: #fa8072;">"LOGF"</span> <span style="color: #fa8072;">"LSTO"</span> <span style="color: #fa8072;">"MAN"</span> <span style="color: #fa8072;">"MAT?"</span>  <span style="color: #fa8072;">"MEAN"</span> <span style="color: #fa8072;">"MENU"</span> <span style="color: #fa8072;">"MOD"</span> <span style="color: #fa8072;">"MVAR"</span> <span style="color: #fa8072;">"N!"</span>  <span style="color: #fa8072;">"NEWMAT"</span>
                                                  <span style="color: #fa8072;">"NOP"</span> <span style="color: #fa8072;">"NORM"</span> <span style="color: #fa8072;">"NOT"</span> <span style="color: #fa8072;">"OCTM"</span> <span style="color: #fa8072;">"OFF"</span> <span style="color: #fa8072;">"OLD"</span> <span style="color: #fa8072;">"ON"</span> <span style="color: #fa8072;">"OR"</span> <span style="color: #fa8072;">"PERM"</span> <span style="color: #fa8072;">"PGMINT"</span> <span style="color: #fa8072;">"PGMSLV"</span> <span style="color: #fa8072;">"PIXEL"</span> <span style="color: #fa8072;">"POLAR"</span> <span style="color: #fa8072;">"POSA"</span> <span style="color: #fa8072;">"PRA"</span> <span style="color: #fa8072;">"PRLCD"</span>
                                                  <span style="color: #fa8072;">"PROFF"</span> <span style="color: #fa8072;">"PROMPT"</span> <span style="color: #fa8072;">"PRON"</span> <span style="color: #fa8072;">"PRSTK"</span> <span style="color: #fa8072;">"PRUSR"</span> <span style="color: #fa8072;">"PRV"</span> <span style="color: #fa8072;">"PRX"</span> <span style="color: #fa8072;">"PR&#931;"</span> <span style="color: #fa8072;">"PSE"</span> <span style="color: #fa8072;">"PUTM"</span> <span style="color: #fa8072;">"PWRF"</span> <span style="color: #fa8072;">"R&lt;&gt;R"</span> <span style="color: #fa8072;">"RAD"</span> <span style="color: #fa8072;">"RAN"</span> <span style="color: #fa8072;">"RCL"</span> <span style="color: #fa8072;">"RCL+"</span>
                                                  <span style="color: #fa8072;">"RCL-"</span> <span style="color: #fa8072;">"RCLEL"</span> <span style="color: #fa8072;">"RCLIJ"</span> <span style="color: #fa8072;">"RCL&#215;"</span> <span style="color: #fa8072;">"RCL&#247;"</span> <span style="color: #fa8072;">"RDX,"</span> <span style="color: #fa8072;">"RDX."</span>  <span style="color: #fa8072;">"REAL?"</span>  <span style="color: #fa8072;">"REALRES"</span> <span style="color: #fa8072;">"RECT"</span> <span style="color: #fa8072;">"RND"</span> <span style="color: #fa8072;">"RNRM"</span> <span style="color: #fa8072;">"ROTXY"</span> <span style="color: #fa8072;">"RSUM"</span> <span style="color: #fa8072;">"RTN"</span>
                                                  <span style="color: #fa8072;">"RTNERR"</span> <span style="color: #fa8072;">"RTNYES"</span> <span style="color: #fa8072;">"RTNNO"</span> <span style="color: #fa8072;">"R&#8593;"</span> <span style="color: #fa8072;">"R&#8595;"</span> <span style="color: #fa8072;">"SCI"</span> <span style="color: #fa8072;">"SDEV"</span> <span style="color: #fa8072;">"SEED"</span> <span style="color: #fa8072;">"SF"</span> <span style="color: #fa8072;">"SIGN"</span> <span style="color: #fa8072;">"SIN"</span> <span style="color: #fa8072;">"SINH"</span> <span style="color: #fa8072;">"SIZE"</span> <span style="color: #fa8072;">"SLOPE"</span> <span style="color: #fa8072;">"SOLVE"</span> <span style="color: #fa8072;">"SQRT"</span>
                                                  <span style="color: #fa8072;">"STO"</span> <span style="color: #fa8072;">"STO+"</span> <span style="color: #fa8072;">"STO-"</span> <span style="color: #fa8072;">"STOEL"</span> <span style="color: #fa8072;">"STOIJ"</span> <span style="color: #fa8072;">"STOP"</span> <span style="color: #fa8072;">"STO&#215;"</span> <span style="color: #fa8072;">"STO&#247;"</span> <span style="color: #fa8072;">"STR?"</span>  <span style="color: #fa8072;">"SUM"</span> <span style="color: #fa8072;">"TAN"</span> <span style="color: #fa8072;">"TANH"</span> <span style="color: #fa8072;">"TONE"</span> <span style="color: #fa8072;">"TRACE"</span> <span style="color: #fa8072;">"TRANS"</span> <span style="color: #fa8072;">"UVEC"</span>
                                                  <span style="color: #fa8072;">"VARMENU"</span> <span style="color: #fa8072;">"VIEW"</span> <span style="color: #fa8072;">"WMEAN"</span> <span style="color: #fa8072;">"WRAP"</span> <span style="color: #fa8072;">"WSIZE?"</span>  <span style="color: #fa8072;">"X&lt;0?"</span>  <span style="color: #fa8072;">"X&lt;&gt;"</span> <span style="color: #fa8072;">"X&lt;&gt;Y"</span> <span style="color: #fa8072;">"X&lt;Y?"</span>  <span style="color: #fa8072;">"X=0?"</span>  <span style="color: #fa8072;">"X=Y?"</span>  <span style="color: #fa8072;">"X&gt;0?"</span>  <span style="color: #fa8072;">"X&gt;Y?"</span>  <span style="color: #fa8072;">"XEQ"</span> <span style="color: #fa8072;">"XTOA"</span>
                                                  <span style="color: #fa8072;">"X&#8593;2"</span> <span style="color: #fa8072;">"X&#8800;0?"</span>  <span style="color: #fa8072;">"X&#8800;Y?"</span>  <span style="color: #fa8072;">"X&#8804;0?"</span>  <span style="color: #fa8072;">"X&#8804;Y?"</span>  <span style="color: #fa8072;">"X&#8805;0?"</span>  <span style="color: #fa8072;">"X&#8805;Y?"</span>  <span style="color: #fa8072;">"X&#8805;Y?"</span>  <span style="color: #fa8072;">"YINT"</span> <span style="color: #fa8072;">"Y&#8593;X"</span> <span style="color: #fa8072;">"[FIND]"</span> <span style="color: #fa8072;">"[MAX]"</span> <span style="color: #fa8072;">"[MIN]"</span> <span style="color: #fa8072;">"&#215;"</span> <span style="color: #fa8072;">"&#247;"</span> <span style="color: #fa8072;">"&#931;+"</span>
                                                  <span style="color: #fa8072;">"&#931;-"</span> <span style="color: #fa8072;">"&#931;REG"</span> <span style="color: #fa8072;">"&#931;REG?"</span>  <span style="color: #fa8072;">"&#8592;"</span> <span style="color: #fa8072;">"&#8593;"</span> <span style="color: #fa8072;">"&#8594;"</span> <span style="color: #fa8072;">"&#8594;DEC"</span> <span style="color: #fa8072;">"&#8594;DEG"</span> <span style="color: #fa8072;">"&#8594;HMS"</span> <span style="color: #fa8072;">"&#8594;HR"</span> <span style="color: #fa8072;">"&#8594;OCT"</span> <span style="color: #fa8072;">"&#8594;POL"</span> <span style="color: #fa8072;">"&#8594;RAD"</span> <span style="color: #fa8072;">"&#8594;REC"</span> <span style="color: #fa8072;">"&#8595;"</span> <span style="color: #fa8072;">"DDAYS"</span> <span style="color: #fa8072;">"DOW"</span> <span style="color: #fa8072;">"CLK12"</span>
                                                  <span style="color: #fa8072;">"CLK24"</span> <span style="color: #fa8072;">"DMY"</span> <span style="color: #fa8072;">"MDY"</span> <span style="color: #fa8072;">"YMD"</span> <span style="color: #fa8072;">"DATE"</span> <span style="color: #fa8072;">"TIME"</span> <span style="color: #fa8072;">"DATE+"</span> <span style="color: #fa8072;">"PI"</span> <span style="color: #fa8072;">"WSIZE"</span> <span style="color: #fa8072;">"BSIGNED"</span> <span style="color: #fa8072;">"BWRAP"</span> <span style="color: #fa8072;">"XOR"</span>)
                                                <span style="color: #b0c4de;">:test</span> #'string-equal))

(<span style="color: #00ffff;">defun</span> <span style="color: #00fa9a; font-weight: bold;">MJR-custom-gen-lab</span> (atrg row) (<span style="color: #00ffff;">if</span> (not (MJR-is-42-builtin atrg))
                                         (<span style="color: #00ffff;">if</span> (string-match-p <span style="color: #fa8072;">"^LBL [0-9][0-9]$"</span> atrg)
                                             (substring auto-trg 4)
                                             (message <span style="color: #fa8072;">"\"%s\""</span> atrg))))

(<span style="color: #00ffff;">defun</span> <span style="color: #00fa9a; font-weight: bold;">MJR-custom-gen-sub</span> (atrg target row) (message <span style="color: #fa8072;">"%s"</span> atrg))
</pre>
</div>
</div>
</div>
<div id="outline-container-org2af792b" class="outline-3">
<h3 id="org2af792b"><span class="section-number-3">3.3.</span> Always generate local lables</h3>
<div class="outline-text-3" id="text-3-3">
<p>
This function is handy when you want to always generate local labels.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #00ffff;">defun</span> <span style="color: #00fa9a; font-weight: bold;">MJR-local-only-gen-lab</span> (atrg row) nil)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0c0a0c5" class="outline-2">
<h2 id="org0c0a0c5"><span class="section-number-2">4.</span> Emacs Helper Stuff</h2>
<div class="outline-text-2" id="text-4">
<p>
The elisp file <code>hp42s-mode.el</code> provides few things:
</p>
<ul class="org-ul">
<li>A language mode for free42 code &#x2013; mostly just provides syntax highlighting</li>
<li><code>MJR-ins42char</code>: Lisp function to insert characters given a list of character codes</li>
<li><code>MJR-dired-org-export</code>: Lisp function to export to HTML and tangle all marked files in a dired buffer</li>
<li><code>MJR-process-buffer-as-42s-code</code>: Lisp function to process <b>all free42 code in a buffer</b> for pasting into free42</li>
<li><code>MJR-target-free42-version</code>: Variable used by <code>MJR-process-buffer-as-42s-code</code> &amp; <code>MJR-copy-42s-code-in-region</code> to control version of free42</li>
<li><code>MJR-copy-42s-code-in-region</code>: Lisp function that process marked region for pasting into free42 and puts the test on the kill ring &#x2013; like <code>MJR-process-buffer-as-42s-code</code> but for a region.</li>
</ul>

<p>
To activate the functionality, simply <code>load</code> the <code>hp42s-mode.el</code> file into emacs.  You can evaluate teh folloing block to do that:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(load-file <span style="color: #fa8072;">"../emacs/hp42s-mode.el"</span>)
</pre>
</div>
</div>
<div id="outline-container-org3f03cbf" class="outline-3">
<h3 id="org3f03cbf"><span class="section-number-3">4.1.</span> Prepare Code For Conversion</h3>
<div class="outline-text-3" id="text-4-1">
<p>
I include comments like <code>@@##</code> that I use like compiler directives in C.  They provide a way to remove lines of code that are incompatible or unnecessary for
the target version of free42.  It's a bit of a hack, but it lets me maintain one program for diff-rent versions of free42.  When I "tangle" an <code>org-mode</code>
buffer, the code is automatically filtered for the selected version of free42 (set via <code>MJR-target-free42-version</code>).
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="box" align="center">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">DM42 Version</th>
<th scope="col" class="org-right">Target Free42</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">DMCP 3.26 / DM42 v3.24</td>
<td class="org-right">3.2.6</td>
</tr>

<tr>
<td class="org-left">DMCP 3.25 / DM42 v3.23</td>
<td class="org-right">3.1.8</td>
</tr>

<tr>
<td class="org-left">DMCP 3.22 / DM42 v3.20</td>
<td class="org-right">3.0.5</td>
</tr>

<tr>
<td class="org-left">DMCP 3.21 / DM42 v3.18</td>
<td class="org-right">3.0.2</td>
</tr>

<tr>
<td class="org-left">DMCP-3.20 / DM42-3.17</td>
<td class="org-right">2.5.20</td>
</tr>

<tr>
<td class="org-left">DMCP-3.20 / DM42-3.16</td>
<td class="org-right">2.5.20</td>
</tr>

<tr>
<td class="org-left">DMCP 3.18 / DM42 v3.15</td>
<td class="org-right">2.5.16</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org3f5b256" class="outline-3">
<h3 id="org3f5b256"><span class="section-number-3">4.2.</span> Automatically processing tangled code</h3>
<div class="outline-text-3" id="text-4-2">
<p>
By adding <code>MJR-process-buffer-as-42s-code</code> to the <code>org-babel-post-tangle-hook</code>, you can automatically process tangled code.  You can do that by evaluating
the next block:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(add-hook 'org-babel-post-tangle-hook 'MJR-process-buffer-as-42s-code)
</pre>
</div>

<p>
A handy way to tangle a file, or files in dired, is the <code>MJR-org-export-der</code> in my <code>.emacs</code> file.
</p>
</div>
</div>
<div id="outline-container-org4da2549" class="outline-3">
<h3 id="org4da2549"><span class="section-number-3">4.3.</span> Tangle &amp; Load Tangled File</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #00ffff;">defun</span> <span style="color: #00fa9a; font-weight: bold;">MJR-tangle-and-load</span> ()
  <span style="color: #f08080;">"Tangles current file and attempts to load the tangled file.</span>
<span style="color: #f08080;">The tangled file is determiend by looking backward for a :tangle argument."</span>
  (<span style="color: #00ffff;">interactive</span>)
  (<span style="color: #00ffff;">save-excursion</span> (org-babel-tangle)
                  (<span style="color: #00ffff;">if</span> (re-search-backward <span style="color: #fa8072;">":tangle[[:blank:]]+</span><span style="color: #ff0000; font-weight: bold;">\\</span><span style="color: #ff0000; font-weight: bold;">(</span><span style="color: #fa8072;">[</span><span style="color: #fa8072;">^</span><span style="color: #fa8072;">[:blank:]]+.hp42s</span><span style="color: #ff0000; font-weight: bold;">\\</span><span style="color: #ff0000; font-weight: bold;">)</span><span style="color: #fa8072;">$"</span> nil t)
                      (<span style="color: #00ffff;">let</span> ((file-name (match-string 1)))
                        (<span style="color: #00ffff;">if</span> (<span style="color: #00ffff;">or</span> (string-equal <span style="color: #fa8072;">"yes"</span> file-name) (string-equal <span style="color: #fa8072;">"no"</span> file-name))
                            (message <span style="color: #fa8072;">"No explicit tangle file specified"</span>)
                            (find-file file-name))))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org3560c28" class="outline-3">
<h3 id="org3560c28"><span class="section-number-3">4.4.</span> yas templates</h3>
<div class="outline-text-3" id="text-4-4">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b0c4de;">echo</span> <span style="color: #fa8072;">''</span>
<span style="color: #00ffff;">for</span> f<span style="color: #00ffff;"> in</span> ~/core/yasnippet/hp42s-mode/*; <span style="color: #00ffff;">do</span> cat $<span style="color: #7fffd4;">f</span>; <span style="color: #b0c4de;">echo</span> <span style="color: #fa8072;">''</span>; <span style="color: #00ffff;">done</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8a849db" class="outline-2">
<h2 id="org8a849db"><span class="section-number-2">5.</span> free42 Notes</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org3fd4803" class="outline-3">
<h3 id="org3fd4803"><span class="section-number-3">5.1.</span> Character Set</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-text">  0 &#247;
  1 &#215;
  2 &#8730;
  3 &#8747;
  4 &#9618;
  5 &#931;
  6 &#9656;
  7 &#960;
  8 &#191;
  9 &#8804;
 10 [LF]
 11 &#8805;
 12 &#8800;
 13 &#8629;
 14 &#8595;
 15 &#8594;
 16 &#8592;
 17 &#956;
 18 &#163;
 19 &#176;
 20 &#197;
 21 &#209;
 22 &#196;
 23 &#8737;
 24 &#7431;
 25 &#198;
 26 &#8230;
 27 [ESC]
 28 &#214;
 29 &#220;
 30 &#9618;
 31 &#8226;
 32 [SPACE]
 33 !
 34 "
 35 #
 36 $
 37 %
 38 &amp;
 39 '
 40 (
 41 )
 42 *
 43 +
 44 ,
 45 -
 46 .
 47 /
 48 0
 49 1
 50 2
 51 3
 52 4
 53 5
 54 6
 55 7
 56 8
 57 9
 58 :
 59 ;
 60 &lt;
 61 =
 62 &gt;
 63 ?
 64 @
 65 A
 66 B
 67 C
 68 D
 69 E
 70 F
 71 G
 72 H
 73 I
 74 J
 75 K
 76 L
 77 M
 78 N
 79 O
 80 P
 81 Q
 82 R
 83 S
 84 T
 85 U
 86 V
 87 W
 88 X
 89 Y
 90 Z
 91 [
 92 \
 93 ]
 94 &#8593;
 95 _
 96 `
 97 a
 98 b
 99 c
100 d
101 e
102 f
103 g
104 h
105 i
106 j
107 k
108 l
109 m
110 n
111 o
112 p
113 q
114 r
115 s
116 t
117 u
118 v
119 w
120 x
121 y
122 z
123 {
124 |
125 }
126 ~
127 &#9500;
128 :
129 &#655;
</pre>
</div>
</div>
</div>
<div id="outline-container-org0d03ec2" class="outline-3">
<h3 id="org0d03ec2"><span class="section-number-3">5.2.</span> Date format</h3>
<div class="outline-text-3" id="text-5-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" align="center">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Flag 67</th>
<th scope="col" class="org-left">Flag 31</th>
<th scope="col" class="org-left">Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Set</td>
<td class="org-left">N/A</td>
<td class="org-left">Y.MD</td>
</tr>

<tr>
<td class="org-left">Clear</td>
<td class="org-left">Clear</td>
<td class="org-left">M.DY</td>
</tr>

<tr>
<td class="org-left">Clear</td>
<td class="org-left">Set</td>
<td class="org-left">D.MY</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orga1e82c8" class="outline-3">
<h3 id="orga1e82c8"><span class="section-number-3">5.3.</span> Stats registers</h3>
<div class="outline-text-3" id="text-5-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Register</th>
<th scope="col" class="org-left">Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">ΣREG? +  0</td>
<td class="org-left">Σx</td>
</tr>

<tr>
<td class="org-left">ΣREG? +  1</td>
<td class="org-left">Σx^2</td>
</tr>

<tr>
<td class="org-left">ΣREG? +  2</td>
<td class="org-left">Σy</td>
</tr>

<tr>
<td class="org-left">ΣREG? +  3</td>
<td class="org-left">Σy^2</td>
</tr>

<tr>
<td class="org-left">ΣREG? +  4</td>
<td class="org-left">Σxy</td>
</tr>

<tr>
<td class="org-left">ΣREG? +  5</td>
<td class="org-left">n</td>
</tr>

<tr>
<td class="org-left">ΣREG? +  6</td>
<td class="org-left">Σlnx</td>
</tr>

<tr>
<td class="org-left">ΣREG? +  7</td>
<td class="org-left">Σ(lnx)^2</td>
</tr>

<tr>
<td class="org-left">ΣREG? +  8</td>
<td class="org-left">Σlny</td>
</tr>

<tr>
<td class="org-left">ΣREG? +  9</td>
<td class="org-left">Σ(lny)^2</td>
</tr>

<tr>
<td class="org-left">ΣREG? + 10</td>
<td class="org-left">Σlnxlny</td>
</tr>

<tr>
<td class="org-left">ΣREG? + 11</td>
<td class="org-left">Σxlny</td>
</tr>

<tr>
<td class="org-left">ΣREG? + 12</td>
<td class="org-left">Σylnx</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-orgaa68a31" class="outline-2">
<h2 id="orgaa68a31"><span class="section-number-2">6.</span> DM 42 Notes</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org1f86d10" class="outline-3">
<h3 id="org1f86d10"><span class="section-number-3">6.1.</span> Display</h3>
<div class="outline-text-3" id="text-6-1">
<p>
GrMod is a read write variable.
</p>
<ul class="org-ul">
<li>0 = standard HP-42S resolution 131x16</li>
<li>2 = DM42 full resolution 200x120</li>
<li>3 = DM42 full resolution 400x240</li>
</ul>

<p>
ResX &amp; ResY are read only variables that have the display resolution
</p>
</div>
</div>
</div>
<div id="outline-container-org638f4c6" class="outline-2">
<h2 id="org638f4c6"><span class="section-number-2">7.</span> EOF</h2>
<div class="outline-text-2" id="text-7">
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
</div>
</div>
</div>
<div id="postamble" class="status">
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
</div>
</body>
</html>
